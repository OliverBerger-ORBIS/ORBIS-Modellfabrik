# OSF (ORBIS SmartFactory) - Cursor AI Regeln

## AGENT-VORGEHENSWEISE (VOR JEDER AUFGABE)

**Bei jeder neuen Anforderung:**
1. **Zuerst zur√ºckmelden:** Was hast du verstanden? Was planst du zu tun?
2. **Warten auf "go":** Keine Implementierung, bis User "go" oder "ja" zum Plan sagt.
3. **Nach "go":** Implementieren ohne weitere Freigaben ‚Äì alle geplanten Schritte ausf√ºhren.
4. **Ausnahme:** `git commit` und `git push` nur nach expliziter User-Freigabe.

**Nicht:** Sofort mit search_replace/write/delete beginnen.
**Nicht:** Nach jeder kleinen √Ñnderung erneut fragen.

---

## üö® KRITISCHE VERBOTE (POSITION 1 - H√ñCHSTE PRIORIT√ÑT)

### Angular-App-Verbot (ABSOLUT KRITISCH)
- **NIEMALS Angular-Apps starten ohne User-Freigabe:** `nx serve osf-ui` ‚ùå
- **Grund:** Verursacht Port-Konflikte, Development-Server-Probleme
- **Verboten:** `nx serve osf-ui` ohne explizite User-Best√§tigung
- **Erlaubt:** Nur User startet Angular-Apps
- **Regel:** Agent startet KEINE Angular-Apps ohne explizite Freigabe!

## üéØ ZENTRALE ENTWICKLUNGSREGELN

### Import-Standards (KRITISCH)
- **Absolute Imports f√ºr externe Libraries:** `from '@osf/gateway'` ‚úÖ
- **Relative Imports f√ºr Paket-interne Module:** `from './component'` ‚úÖ
- **Standard Library Imports:** `import { Observable } from 'rxjs'` ‚úÖ
- **KEINE sys.path.append Hacks:** `sys.path.append(...)` ‚ùå
- **Import-Reihenfolge:** Standard Library ‚Üí Third Party ‚Üí Local (absolute) ‚Üí Local (relative)

### Pfad-Standards (KRITISCH)
- **Source-Pfade (Paket-relativ):** `Path(__file__).parent` f√ºr Paket-interne Pfade ‚úÖ
- **Data-Pfade (Projekt-root-relativ):** `project_root / "data/omf-data/sessions"` f√ºr Nutzdaten ‚úÖ (Verzeichnisname bleibt)
- **KEINE absoluten Pfade:** `/Users/oliver/Projects/ORBIS-Modellfabrik/path/to/file` ‚ùå
- **KEINE relativen Pfade:** `../path/to/file` ‚ùå
- **Unterscheidung:** Source-Pfade vs. Data-Pfade je nach Verwendungszweck

### Projekt-Struktur
- **Aktive Sourcen:** `osf/` (OSF Angular Dashboard - aktuell in Entwicklung)
- **Helper-Apps:** `session_manager/` (Session-Replay Helper-App)
- **Dokumentation:** `docs/` (Alle Projekt-Dokumente)
- **Session-Daten:** `data/omf-data/sessions/` (SQLite + Log-Dateien)
- **Log-Dateien:** `data/logs/` (nicht mehr ins Projekt-Root)

### Code-Qualit√§t (OSF - Produktiver Code)
- **TypeScript:** Strikte Typisierung, keine `any` ohne Begr√ºndung
- **ESLint:** Alle Linting-Regeln m√ºssen erf√ºllt sein (Pre-commit Hook)
- **Type Check:** TypeScript Type Checking muss bestehen
- **RxJS:** Observable Patterns korrekt verwenden (`shareReplay`, `refCount: false` f√ºr persistente Streams)
- **Angular:** Component-basierte Architektur, Services f√ºr Business Logic
- **Pre-commit Hooks:** Immer befolgen, nie mit --no-verify √ºberspringen
- **Tests:** Nach jeder √Ñnderung ausf√ºhren, M√úSSEN vor Commit bestehen
- **Commits:** H√§ufig und mit funktionierendem Stand

### Test-Standards (OSF - Produktiver Code)
- **Test-Verzeichnis:** `osf/` Libraries haben Tests in `src/__tests__/`
- **Test-Struktur:** `*.spec.ts` f√ºr Angular Components, `*.spec.ts` f√ºr Libraries
- **Test-Imports:** Absolute Imports auch in Tests verwenden
- **Test-Namen:** `*.spec.ts` oder `*_test.ts`
- **Test-Ausf√ºhrung:** `nx test <project>` oder `nx test --all`
- **Pre-commit:** OSF Tests M√úSSEN vor jedem Commit bestehen
- **Virtual Environment:** F√ºr Python-Tests (Session Manager) immer `.venv` aktivieren

### OSF-spezifische Regeln
- **Tab Stream Pattern:** Pattern 1 oder Pattern 2 korrekt anwenden (siehe [Tab Stream Initialization Pattern](docs/03-decision-records/11-tab-stream-initialization-pattern.md))
- **MessageMonitorService:** F√ºr Timing-unabh√§ngige Datenanzeige verwenden
- **RxJS Streams:** `shareReplay({ bufferSize: 1, refCount: false })` f√ºr persistente Streams
- **Angular Services:** Injectable Services f√ºr Business Logic
- **Component Lifecycle:** OnInit, OnDestroy korrekt implementieren

### Entwicklungsprozess-Regeln
- **Plan-‚Üígo-Flow:** Erst Verst√§ndnis + Plan zur√ºckmelden, auf "go" warten, dann implementieren. Nach "go" keine weiteren Freigaben w√§hrend der Umsetzung.
- **Analyse-Phase:** Codebase durchsuchen, bestehende Komponenten verstehen
- **Zusammenfassung:** Kurze √úbersicht der geplanten √Ñnderungen

### Git-Workflow-Regeln
- **Commits:** NUR nach expliziter Best√§tigung des Users
- **Keine automatischen Commits:** Niemals `git commit` ohne User-Freigabe
- **Staging:** `git add` ist erlaubt, aber nicht `git commit`
- **Push:** Nur nach User-Best√§tigung
- **Workflow:** √Ñnderungen ‚Üí User-Freigabe ‚Üí Commit ‚Üí Push

### "Commit vorbereiten" (bei User-Auftrag)
- **Umfang:** Umgang mit unstaged und untracked Dateien geh√∂rt dazu.
- **Agent-Urteil:** Der Agent hat die Dateien angelegt bzw. ge√§ndert ‚Äì er kennt Kontext:
  - Was geh√∂rt zur Feature-√Ñnderung (stagen)
  - Was war tempor√§r / Skizze / nicht funktionsf√§hig (nicht stagen)
  - Was geh√∂rt in .gitignore (z.B. lokale Build-Artefakte)
- **Vorgehen:** `git status` pr√ºfen ‚Üí gezielt `git add` nur der relevanten Dateien ‚Üí User informieren (was gestaged, was ausgelassen und warum). Bei Unsicherheit nachfragen.

### Angular-Komponenten-Regeln (KRITISCH)
- **Component-basierte Architektur:** Services f√ºr Business Logic, Components f√ºr UI
- **RxJS Observable Patterns:** Korrekte Verwendung von `shareReplay`, `refCount`, `startWith`
- **MessageMonitorService:** F√ºr Timing-unabh√§ngige Datenanzeige verwenden
- **Tab Stream Pattern:** Pattern 1 oder Pattern 2 korrekt anwenden
- **Error-Handling:** Try-catch f√ºr alle Service-Calls
- **UI-Standards:** SVG Icons, Component-basierte Struktur
- **I18n:** `$localize` f√ºr √úbersetzungen verwenden

### Vollst√§ndige Regeln
- **Allgemein:** `docs/03-decision-records/` - OSF Decision Records
- **Architektur:** `docs/02-architecture/project-structure.md` - OSF Project Structure
- **Tab Stream Pattern:** `docs/03-decision-records/11-tab-stream-initialization-pattern.md`

## üö® AUTOMATISCHE REGEL-BEFOLGUNG (KRITISCH)

### MANDATORY COMPLIANCE
- **JEDE Code-√Ñnderung** MUSS diese Regeln automatisch befolgen
- **KEINE Ausnahmen** ohne explizite User-Freigabe
- **Immer pr√ºfen** vor jeder Implementierung:
  - ‚úÖ TypeScript Typisierung korrekt?
  - ‚úÖ RxJS Observable Patterns korrekt?
  - ‚úÖ Tab Stream Pattern korrekt angewendet?
  - ‚úÖ MessageMonitorService verwendet (wenn n√∂tig)?
  - ‚úÖ Pre-commit Hooks kompatibel?
  - ‚úÖ Tests erstellt/aktualisiert?

### AUTOMATISCHE VALIDIERUNG
- **Vor jeder Implementierung:** Regeln pr√ºfen
- **Nach jeder √Ñnderung:** Linting/Formatting pr√ºfen
- **Bei Fehlern:** Sofort korrigieren, nicht ignorieren
- **Bei Unsicherheit:** User fragen, nicht raten

### ENTWICKLUNGSPROZESS (MANDATORY)
1. **Analyse:** Bestehende Komponenten verstehen
2. **Regel-Check:** Alle relevanten Regeln pr√ºfen
3. **Implementierung:** Regeln automatisch befolgen
4. **Validierung:** Pre-commit Hooks, Tests, Linting
5. **Commit:** Nur nach expliziter User-Freigabe (nicht vor Implementierung, sondern vor Commit)

### ZWINGENDE REGELN (NIEMALS IGNORIEREN)
- **TypeScript:** Strikte Typisierung, keine `any` ohne Begr√ºndung
- **ESLint:** Alle Linting-Regeln m√ºssen erf√ºllt sein
- **Type Check:** TypeScript Type Checking muss bestehen
- **RxJS:** Observable Patterns korrekt verwenden
- **Tab Stream Pattern:** Pattern 1 oder Pattern 2 korrekt anwenden
- **MessageMonitorService:** F√ºr Timing-unabh√§ngige Datenanzeige verwenden
- **Pre-commit:** OSF Tests M√úSSEN bestehen, ESLint MUSS bestehen

## üö® WICHTIG
Bei jeder Code-√Ñnderung diese Regeln befolgen!
