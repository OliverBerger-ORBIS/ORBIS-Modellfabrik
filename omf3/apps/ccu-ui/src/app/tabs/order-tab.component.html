<section class="order-tab">
  <header class="order-tab__header">
    <div>
      <div class="order-tab__heading">
        <img src="assets/svg/ui/heading-customer-orders.svg" alt="" aria-hidden="true" />
        <h2 i18n="@@orderTabHeadline">Shopfloor Orders</h2>
      </div>
      <p i18n="@@orderTabDescription">
        Shopfloor orders (production and storage) with detailed step information and shopfloor visualization.
      </p>
    </div>

    <div class="order-tab__fixtures" *ngIf="isMockMode">
      <span class="badge" i18n="@@orderTabFixtureLabel">Fixture</span>
      <div class="fixture-switch">
        <button
          *ngFor="let fixture of fixtureOptions"
          type="button"
          [class.active]="fixture === activeFixture"
          (click)="loadFixture(fixture)"
        >
          {{ fixtureLabels[fixture] }}
        </button>
      </div>
    </div>
  </header>

  <div class="order-tab__grid">
    <section>
      <div class="order-tab__section-heading">
        <img src="assets/svg/ui/heading-production.svg" alt="" aria-hidden="true" />
        <h3 i18n="@@orderTabProductionHeadline">Production orders</h3>
      </div>

      <article class="order-section">
        <h4 i18n="@@orderTabProductionActive">Active</h4>
        <ng-container *ngIf="productionActive$ | async as orders; else loading">
          <p class="empty" *ngIf="orders.length === 0" i18n="@@orderTabProductionActiveEmpty">
            No active production orders.
          </p>
          <app-order-card *ngFor="let order of orders" [order]="order" />
        </ng-container>
      </article>

      <article class="order-section">
        <div class="order-section__header">
          <h4 i18n="@@orderTabProductionCompleted">Completed</h4>
          <button
            type="button"
            class="order-section__toggle"
            (click)="toggleProductionCompleted()"
            [attr.aria-expanded]="!productionCompletedCollapsed"
            [attr.aria-label]="productionCompletedToggleLabel"
            [title]="productionCompletedToggleLabel"
          >
            <span
              [class]="productionCompletedCollapsed ? 'toggle-icon toggle-icon--closed' : 'toggle-icon toggle-icon--open'"
            ></span>
          </button>
        </div>
        <ng-container *ngIf="!productionCompletedCollapsed">
          <ng-container *ngIf="productionCompleted$ | async as orders; else loading">
            <p class="empty" *ngIf="orders.length === 0" i18n="@@orderTabProductionCompletedEmpty">
              No completed production orders.
            </p>
            <app-order-card
              *ngFor="let order of orders; trackBy: trackOrder"
              [order]="order"
              [isCompleted]="true"
            />
          </ng-container>
        </ng-container>
      </article>
    </section>

    <section>
      <div class="order-tab__section-heading">
        <img src="assets/svg/ui/heading-storage.svg" alt="" aria-hidden="true" />
        <h3 i18n="@@orderTabStorageHeadline">Storage orders</h3>
      </div>

      <article class="order-section">
        <h4 i18n="@@orderTabStorageActive">Active</h4>
        <ng-container *ngIf="storageActive$ | async as orders; else loading">
          <p class="empty" *ngIf="orders.length === 0" i18n="@@orderTabStorageActiveEmpty">
            No active storage orders.
          </p>
          <app-order-card *ngFor="let order of orders" [order]="order" />
        </ng-container>
      </article>

      <article class="order-section">
        <div class="order-section__header">
          <h4 i18n="@@orderTabStorageCompleted">Completed</h4>
          <button
            type="button"
            class="order-section__toggle"
            (click)="toggleStorageCompleted()"
            [attr.aria-expanded]="!storageCompletedCollapsed"
            [attr.aria-label]="storageCompletedToggleLabel"
            [title]="storageCompletedToggleLabel"
          >
            <span
              [class]="storageCompletedCollapsed ? 'toggle-icon toggle-icon--closed' : 'toggle-icon toggle-icon--open'"
            ></span>
          </button>
        </div>
        <ng-container *ngIf="!storageCompletedCollapsed">
          <ng-container *ngIf="storageCompleted$ | async as orders; else loading">
            <p class="empty" *ngIf="orders.length === 0" i18n="@@orderTabStorageCompletedEmpty">
              No completed storage orders.
            </p>
            <app-order-card
              *ngFor="let order of orders; trackBy: trackOrder"
              [order]="order"
              [isCompleted]="true"
              [expanded]="order.orderId === expandedStorageOrderId"
            />
          </ng-container>
        </ng-container>
      </article>
    </section>
  </div>
</section>

<ng-template #loading>
  <p class="empty" i18n="@@orderTabLoading">Loading ordersâ€¦</p>
</ng-template>
