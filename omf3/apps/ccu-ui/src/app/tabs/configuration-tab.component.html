<section class="configuration-tab" *ngIf="viewModel$ | async as vm; else loading">
  <section class="card">
    <header class="section-header">
      <img [src]="factoryIcon" alt="Factory icon" width="56" height="56" />
      <div>
        <h2 i18n="@@configurationFactoryHeadline">Factory Configuration</h2>
        <p i18n="@@configurationFactoryDescription">
          Factory layout configuration and module positioning
        </p>
      </div>
      <div class="configuration-tab__fixtures" *ngIf="isMockMode">
        <span class="badge" i18n="@@orderTabFixtureLabel">Fixture</span>
        <div class="fixture-switch">
          <button
            *ngFor="let fixture of fixtureOptions"
            type="button"
            [class.active]="fixture === activeFixture"
            (click)="loadFixture(fixture)"
          >
            {{ fixtureLabels[fixture] }}
          </button>
        </div>
      </div>
    </header>

    <div class="shopfloor-wrapper">
      <app-shopfloor-preview
        [order]="null"
        [scale]="1"
        [badgeText]="vm.badgeText"
        [infoText]="vm.infoText"
        [highlightModulesOverride]="vm.highlightModules"
        [highlightFixedOverride]="vm.highlightFixed"
        [selectionEnabled]="true"
        [showBaseRoads]="false"
        (cellSelected)="onCellSelected($event)"
        (cellDoubleClicked)="onCellDoubleClick($event)"
      ></app-shopfloor-preview>
    </div>

    <section class="detail-panel" *ngIf="vm.detailPanel as panel">
      <ng-container *ngIf="panel.kind === 'default'">
        <section class="selection-panel">
          <header>
            <h3>{{ panel.selection.title }}</h3>
            <p *ngIf="panel.selection.subtitle">{{ panel.selection.subtitle }}</p>
          </header>
          <ul>
            <li *ngFor="let item of panel.selection.items">
              <span class="label">{{ item.label }}</span>
              <span class="value">{{ item.value }}</span>
            </li>
          </ul>
        </section>
      </ng-container>

      <app-orbis-detail
        *ngIf="panel.kind === 'orbis'"
        [view]="panel.view"
        (phaseSelected)="selectOrbisPhase($event)"
        (useCaseToggled)="toggleOrbisUseCase($event)"
      ></app-orbis-detail>

      <!-- New animated SVG-based architecture component (default) -->
      <app-dsp-architecture
        *ngIf="panel.kind === 'dsp'"
        [view]="panel.view"
        (actionTriggered)="openExternalLink($event.url)"
      ></app-dsp-architecture>

      <!-- Legacy component (kept as fallback, uncomment to use):
      <app-dsp-detail
        *ngIf="panel.kind === 'dsp'"
        [view]="panel.view"
        (actionTriggered)="openExternalLink($event.url)"
      ></app-dsp-detail>
      -->
    </section>
  </section>

  <section class="card">
    <header class="section-header">
      <img [src]="parametersIcon" alt="Parameters icon" width="48" height="48" />
      <div>
        <h2 i18n="@@configurationParametersHeadline">Parameter Configuration</h2>
        <p i18n="@@configurationParametersDescription">
          OMF production parameters and settings
        </p>
      </div>
    </header>

    <div class="parameter-grid">
      <article class="parameter-card" *ngFor="let card of vm.parameterCards">
        <header>
          <img [src]="card.icon" [alt]="card.title" width="40" height="40" />
          <div>
            <h3>{{ card.title }}</h3>
            <p *ngIf="card.description">{{ card.description }}</p>
          </div>
        </header>
        <ul>
          <li *ngFor="let item of card.items">
            <div class="item-icon" *ngIf="item.icon">
              <img [src]="item.icon" [alt]="item.label" width="36" height="36" />
            </div>
            <span class="label">{{ item.label }}</span>
            <span class="value">{{ item.value }}</span>
          </li>
        </ul>
      </article>
    </div>
  </section>

</section>

<ng-template #loading>
  <section class="card placeholder">
    <p i18n="@@configurationLoading">Loading configurationâ€¦</p>
  </section>
</ng-template>
