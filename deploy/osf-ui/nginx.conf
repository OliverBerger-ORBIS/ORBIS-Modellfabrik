# OSF-UI nginx config â€“ SPA routing, localized (en/de/fr)
# Served on port 80 inside container; map to 8080 on host for RPi

map $sent_http_content_type $expires {
    default                    off;
    text/html                  epoch;
    text/css                   max;
    application/json           max;
    application/javascript     max;
    ~image/                    max;
}

server {
    listen 80;
    server_name localhost;
    root /usr/share/nginx/html;
    index index.html;

    set $lang en;

    if ($http_accept_language ~* "^de") {
        set $lang de;
    }
    if ($http_accept_language ~* "^fr") {
        set $lang fr;
    }
    if ($http_accept_language ~* "^en") {
        set $lang en;
    }

    # / -> redirect to locale
    location = / {
        return 302 $scheme://$http_host/$lang/;
    }

    # SPA fallback for locale routes (/en, /en/, /en/dsp, ...)
    location ~ ^/(en|de|fr)(/.*)?$ {
        set $locale $1;
        try_files $uri $uri/ /$locale/index.html =404;
    }

    # Assets
    location /assets/ {
        add_header Cache-Control "public, max-age=31536000";
    }

    location /locale/ {
        add_header Cache-Control "public, max-age=3600";
    }

    expires $expires;
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml;
}
