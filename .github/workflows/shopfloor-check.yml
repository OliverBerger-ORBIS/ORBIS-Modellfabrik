name: Shopfloor Component Tests (OMF3)

on:
  push:
    branches: [ main, develop, 'feature/shopfloor-*' ]
    paths:
      - 'osf/apps/osf-ui/src/app/components/shopfloor-preview/**'
      - 'osf/apps/osf-ui/public/shopfloor/**'
      - 'osf/libs/testing-fixtures/**'
  pull_request:
    branches: [ main, develop ]
    paths:
      - 'osf/apps/osf-ui/src/app/components/shopfloor-preview/**'
      - 'osf/apps/osf-ui/public/shopfloor/**'
      - 'osf/libs/testing-fixtures/**'

jobs:
  test-shopfloor-omf3:
    runs-on: ubuntu-latest
    name: Test Shopfloor Component (OMF3)
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        submodules: recursive
    
    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
    
    - name: Install Node.js dependencies
      run: |
        npm ci
    
    # IMPORTANT: Use 'npm test' (NOT 'npx nx test --all')
    # See .github/WORKFLOW_GUIDELINES.md for details
    # This was fixed in commit b4e130c - do not change back!
    - name: Run OMF3 tests (includes shopfloor component tests)
      run: |
        echo "üß™ Running OMF3 tests (includes shopfloor component)..."
        npm test
    
    - name: Verify shopfloor layout JSON exists
      run: |
        if [ ! -f "osf/apps/osf-ui/public/shopfloor/shopfloor_layout.json" ]; then
          echo "‚ùå shopfloor_layout.json not found"
          exit 1
        else
          echo "‚úÖ shopfloor_layout.json exists"
        fi
    
    - name: Test summary
      if: always()
      run: |
        echo "üìä Shopfloor Component Test Summary (OMF3)"
        echo "=========================================="
        echo "‚úÖ OMF3 tests completed (includes shopfloor component)"
        echo "‚úÖ Shopfloor layout JSON verified"
