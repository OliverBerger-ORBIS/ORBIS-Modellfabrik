name: Shopfloor Component Tests (OMF3)

on:
  push:
    branches: [ main, develop, 'feature/shopfloor-*' ]
    paths:
      - 'omf3/apps/ccu-ui/src/app/components/shopfloor-preview/**'
      - 'omf3/apps/ccu-ui/public/shopfloor/**'
      - 'omf3/libs/testing-fixtures/**'
  pull_request:
    branches: [ main, develop ]
    paths:
      - 'omf3/apps/ccu-ui/src/app/components/shopfloor-preview/**'
      - 'omf3/apps/ccu-ui/public/shopfloor/**'
      - 'omf3/libs/testing-fixtures/**'

jobs:
  test-shopfloor-omf3:
    runs-on: ubuntu-latest
    name: Test Shopfloor Component (OMF3)
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        submodules: recursive
    
    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
    
    - name: Install Node.js dependencies
      run: |
        npm ci
    
    - name: Run OMF3 tests (includes shopfloor component tests)
      run: |
        echo "üß™ Running OMF3 tests (includes shopfloor component)..."
        npx nx test --all
    
    - name: Verify shopfloor layout JSON exists
      run: |
        if [ ! -f "omf3/apps/ccu-ui/public/shopfloor/shopfloor_layout.json" ]; then
          echo "‚ùå shopfloor_layout.json not found"
          exit 1
        else
          echo "‚úÖ shopfloor_layout.json exists"
        fi
    
    - name: Test summary
      if: always()
      run: |
        echo "üìä Shopfloor Component Test Summary (OMF3)"
        echo "=========================================="
        echo "‚úÖ OMF3 tests completed (includes shopfloor component)"
        echo "‚úÖ Shopfloor layout JSON verified"
