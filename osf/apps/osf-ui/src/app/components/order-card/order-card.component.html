<ng-container *ngIf="order as currentOrder">
<article class="order-card" [class.order-card--completed]="isCompleted">
  <header class="order-card__header">
    <div class="order-card__title">
      <img class="order-card__type-icon" [src]="orderTypeIcon" alt="" aria-hidden="true" />
      <img
        *ngIf="workpieceIcon as icon"
        class="order-card__workpiece-icon"
        [src]="icon"
        alt=""
        aria-hidden="true"
      />
      <div *ngIf="orderStartedAt as started" class="order-card__time">
        {{ started }}
      </div>
    </div>
    <div class="order-card__status" [ngClass]="headerStatus.class">
      {{ headerStatus.label }}
    </div>
    <button
      type="button"
      class="order-card__toggle"
      (click)="toggleCollapse()"
      [attr.aria-expanded]="!collapsed"
      [attr.aria-label]="getToggleDetailsLabel()"
    >
      <span [class]="collapsed ? 'toggle-icon toggle-icon--closed' : 'toggle-icon toggle-icon--open'"></span>
    </button>
  </header>

  <section class="order-card__content" *ngIf="!collapsed">
    <div class="order-card__content-grid">
      <!-- Left: Shopfloor Preview -->
      <div class="order-card__shopfloor">
        <app-shopfloor-preview
          [order]="currentOrder"
          [activeStep]="previewStep"
          [scale]="0.7"
          [showZoomControls]="true"
        />
      </div>

      <!-- Right: Steps -->
      <div class="order-card__steps">
        <h3 i18n="@@orderCardStepsHeadline">Steps</h3>
        <ul>
          <li
            *ngFor="let step of steps; index as idx; trackBy: trackStep"
            [class]="'step-row ' + stepBackgroundClass(step)"
          >
            <span class="step__number">{{ getStepNumberLabel(idx + 1) }}</span>
            <span
              class="step__status-icon"
              [class]="stepStatusClass(step)"
              [attr.aria-label]="stepStateLabel(step)"
            >
              {{ stepStatusIcon(step) }}
            </span>
            <span class="step__module">
              <img
                *ngIf="moduleIcon(step) as moduleIconPath"
                [src]="moduleIconPath"
                class="step__module-icon"
                alt=""
              />
              <span class="step__module-name" [title]="moduleFullName(step)">{{ moduleName(step) }}</span>
            </span>
            <span class="step__command-text">
              {{ commandLabel(step) }}
              <img
                *ngIf="targetModuleIcon(step) as targetIconPath"
                [src]="targetIconPath"
                class="step__target-module-icon"
                alt=""
              />
            </span>
          </li>
        </ul>
      </div>
    </div>

    <footer class="order-card__details">
      <div class="detail-group" *ngIf="currentOrder.orderId as orderId">
        <span class="detail-label" i18n="@@orderCardOrderId">Order ID</span>
        <span class="detail-value">{{ orderId }}</span>
      </div>
      <ng-container *ngIf="correlationInfo$ | async as info">
        <div class="detail-group order-card__erp" *ngIf="info.orderType === 'CUSTOMER' && info.customerOrderId">
          <span class="detail-label" i18n="@@orderCardErpCustomerOrder">ERP Customer Order</span>
          <span class="detail-value">{{ info.customerOrderId }}{{ info.customerId ? ' Â· ' + info.customerId : '' }}</span>
        </div>
        <div class="detail-group order-card__erp" *ngIf="info.orderType === 'PURCHASE' && info.purchaseOrderId">
          <span class="detail-label" i18n="@@orderCardErpPurchaseOrder">ERP Purchase Order</span>
          <span class="detail-value">{{ info.purchaseOrderId }}{{ info.supplierId ? ' Â· ' + info.supplierId : '' }}</span>
        </div>
      </ng-container>
      <div class="detail-group order-card__correlate" *ngIf="onRequestCorrelation && currentOrder.orderId">
        <button
          type="button"
          class="order-card__correlate-btn"
          (click)="requestCorrelation()"
          [attr.aria-label]="requestCorrelationButtonLabel"
          [title]="requestCorrelationButtonLabel"
        >
          <span aria-hidden="true">ðŸ“‹</span>
          {{ requestCorrelationButtonLabel }}
        </button>
      </div>
      <div class="detail-group" *ngIf="orderDuration as duration">
        <span class="detail-label" i18n="@@orderCardDuration">Duration</span>
        <span class="detail-value">{{ duration }}</span>
      </div>
      <div class="detail-group" *ngIf="workpieceId as workpiece">
        <span class="detail-label" i18n="@@orderCardWorkpiece">Workpiece</span>
        <span class="detail-value">{{ workpiece }}</span>
      </div>
      <div class="detail-group" *ngIf="activeStepStartedAt as stepStart">
        <span class="detail-label" i18n="@@orderCardActiveStepStarted">Active step started</span>
        <span class="detail-value">{{ stepStart }}</span>
      </div>
    </footer>
  </section>
</article>
</ng-container>

