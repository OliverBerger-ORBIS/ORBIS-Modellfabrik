version: 1.0.0
keys:
  workpieceId:
    search_paths:
      - "$.workpieceId"
      - "$.metadata.workpiece.workpieceId"
      - "$.action.metadata.workpiece.workpieceId"
      - "$.workpiece.workpieceId"
      - "$.loadId"
      - "$.id"
  moduleId:
    search_paths:
      - "$.moduleId"
      - "$.source"
      - "$.target"
      - "$.id"
  orderId: "$.orderId"
  subOrderId: "$.subOrderId"
  actionId: "$.actionId"
  jobId: "$.jobId"
  reqId: "$.reqId"

constraints:
  orderId: "uuid-v4"
  actionId: "uuid-v4"
  subOrderId:
    format: "${orderId}:${seq}"
    seq: "integer >= 0"
  invariants:
    - "messages(orderId=X) keep same orderId"
    - "reqId unique per module per session"
