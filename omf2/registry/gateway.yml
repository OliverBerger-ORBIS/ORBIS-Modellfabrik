metadata:
  version: "2.1.0"
  last_updated: "2025-10-25"
  author: "OMF Development Team"
  description: |
    Gateway-Konfiguration für OMF2 CCU Gateway
    
    WICHTIG - Semantik:
    - routing_hints: Topics die vom Gateway an Business-Functions geroutet werden
    - refresh_triggers: Topics die UI-Refresh-Events triggern
    
    HINWEIS:
    - Diese Konfiguration wurde aus mqtt_clients.yml ausgelagert
    - Gateway nutzt diese Daten für Topic-Routing-Logik
    - Alle routed_topics MÜSSEN in ccu_mqtt_client.subscribed_topics sein

# Gateway Routing Configuration
gateway:
  # ==============================================================================
  # GATEWAY-ROUTING-HINTS für Business-Functions
  # ==============================================================================
  # SEMANTIK:
  #   - Diese Topics MÜSSEN im Domain-Client subscribed sein (siehe mqtt_clients.yml)
  #   - UND werden vom Gateway an die jeweilige Business-Function geroutet
  #   - Das Gateway empfängt über onMessage() und leitet weiter
  # 
  # WICHTIG:
  #   - Business-Functions machen KEINE eigene MQTT-Subscription!
  #   - Sie erhalten Topics vom Gateway via onMessage()
  #   - Validierung: Alle routed_topics MÜSSEN in ccu_mqtt_client.subscribed_topics sein
  # ==============================================================================
  routing_hints:
    sensor_manager:
      routed_topics:  # Topics die an SensorManager.onMessage() geroutet werden
        - "/j1/txt/1/i/bme680"    # BME680 Sensor-Daten (TXT-AIQS)
        - "/j1/txt/1/i/ldr"       # LDR Sensor-Daten (TXT-AIQS)
        - "/j1/txt/1/i/cam"       # Camera-Daten (TXT-AIQS)
    
    module_manager:
      routed_topics:  # Topics die an ModuleManager.onMessage() geroutet werden
        # Direkte Module Topics (State/Connection/Factsheet)
        # HBW (via NodeRed - no TXT):
        - "module/v1/ff/SVR3QA0022/state"
        - "module/v1/ff/SVR3QA0022/connection"
        - "module/v1/ff/SVR3QA0022/factsheet"
        # DRILL (via NodeRed - no TXT):
        - "module/v1/ff/SVR4H76449/state"
        - "module/v1/ff/SVR4H76449/connection"
        - "module/v1/ff/SVR4H76449/factsheet"
        # MILL (via NodeRed - no TXT):
        - "module/v1/ff/SVR3QA2098/state"
        - "module/v1/ff/SVR3QA2098/connection"
        - "module/v1/ff/SVR3QA2098/factsheet"
        # AIQS (direct from TXT - fast telemetry):
        - "module/v1/ff/SVR4H76530/state"
        - "module/v1/ff/SVR4H76530/connection"
        - "module/v1/ff/SVR4H76530/factsheet"
        # DPS (direct from TXT - fast telemetry):
        - "module/v1/ff/SVR4H73275/state"
        - "module/v1/ff/SVR4H73275/connection"
        - "module/v1/ff/SVR4H73275/factsheet"
        # CHRG (Charger):
        - "module/v1/ff/CHRG0/state"
        - "module/v1/ff/CHRG0/connection"
        - "module/v1/ff/CHRG0/factsheet"
        # FTS Topics (direct from TXT-FTS):
        - "fts/v1/ff/5iO4/state"
        - "fts/v1/ff/5iO4/connection"
        - "fts/v1/ff/5iO4/factsheet"
    
    stock_manager:
      routed_topics:  # Topics die an StockManager.onMessage() geroutet werden
        - "/j1/txt/1/f/i/stock"      # HBW Inventory FROM TXT (Stock-Management)

    order_manager:
      routed_topics:  # Topics die an OrderManager.onMessage() geroutet werden
        - "ccu/order/request"         # PRIMARY trigger for new orders
        - "ccu/order/response"        # Order confirmation with UUID
        - "ccu/order/active"          # Active orders queue
        - "ccu/order/completed"       # Completed orders log
        - "fts/v1/ff/5iO4/state"      # FTS state for order tracking
        - "module/v1/ff/NodeRed/SVR3QA0022/state"  # HBW state for PICK/DROP tracking via NodeRED
        - "module/v1/ff/NodeRed/SVR4H76449/state"  # DRILL state for DRILL tracking via NodeRED
        - "module/v1/ff/NodeRed/SVR3QA2098/state"  # MILL state for MILL tracking via NodeRED
        - "module/v1/ff/SVR4H76530/state"  # AIQS state for CHECK_QUALITY tracking
        - "module/v1/ff/SVR4H73275/state"  # DPS state for DROP tracking
        - "module/v1/ff/NodeRed/SVR4H73275/state"  # DPS via NodeRED
        - "module/v1/ff/NodeRed/SVR4H76530/state"  # AIQS via NodeRED

  # ==============================================================================
  # UI REFRESH TRIGGERS
  # ==============================================================================
  # Topics die UI-Refresh-Events triggern sollen
  # Wird von Streamlit Dashboard verwendet für Auto-Refresh
  # ==============================================================================
  # Optional: gruppenspezifische Refresh-Intervalle (Sekunden)
  refresh_intervals:
    order_updates: 0.5
    module_updates: 2.0
    sensor_updates: 10.0

  refresh_triggers:
    # Sensor Data Updates
    sensor_updates:
      - "/j1/txt/1/i/bme680"
      - "/j1/txt/1/i/ldr"
      - "/j1/txt/1/i/cam"
    
    # Module State Updates
    module_updates:
      - "module/v1/ff/*/state"
      - "module/v1/ff/*/connection"
      - "fts/v1/ff/*/state"
      - "fts/v1/ff/*/connection"
    
    # Order Updates
    order_updates:
      - "ccu/order/active"
      - "ccu/order/completed"
      - "ccu/order/request"
      - "ccu/order/response"
    
    # Stock Updates
    stock_updates:
      - "/j1/txt/1/f/i/stock"
      - "ccu/state/stock"
